{"version":3,"sources":["routers/user.js"],"names":["router","Router","use","post","phoneValidator","md5Validator","req","res","formData","body","findOne","phone","then","data","status","json","code","msg","password","password_salt","loginResponse","catch","dbQueryErr","repeatabilityValidator","vCodeValidator","vCode","time","Date","getTime","userData","getRandomCode","avatar","register_time","last_time","permission","user","save","dbWriteErr","access_token","update","$set","expires","now","cookie","userInfo","username","r","console","log","i","Math","random","toString","type","send","apikey","SMS_APIKEY","mobile","text","APP_NAME","end","err","sendSuccessResponse","sms","queryObj","setTimeout","findObj","remove","next","phoneRegexp","test","md5Regexp","length","chars","charAt","floor"],"mappings":"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","file":"user.js","sourcesContent":["/*\n * 用户相关的请求响应路由\n * @Author: Cphayim \n * @Date: 2017-04-21 21:23:45 \n * @Last Modified by: Cphayim\n * @Last Modified time: 2017-05-07 01:09:25\n */\n\nimport express from 'express'\n// 请求转发模块\nimport request from 'superagent'\n// cookie 解析模块\nimport cookieParser from 'cookie-parser'\n// 数据库连接模块\nimport {\n    User,\n    SMS\n} from '../modules/db'\n// 配置模块\nimport config from '../modules/config'\n// MD5 算法模块\nimport {\n    MD5\n} from '../modules/md5'\n// 响应错误信息的模块\nimport errRes from '../modules/err-res'\n\n/*\n * 随机码规范\n * password_salt    16位\n * access_token     32位\n */\n\n// 创建路由\nconst router = express.Router();\nrouter.use(cookieParser());\n\n// 登录表单响应接口 [预处理管道: 手机格式验证、密码加密验证]\nrouter.post('/login', [phoneValidator, md5Validator], (req, res) => {\n    const formData = req.body;\n    // 数据库查询\n    User.findOne({\n        phone: formData.phone\n    }).then(data => {\n        // 没找到账号 (data:null)\n        if (!data) {\n            res.status(200).json({\n                code: 'fail',\n                msg: 'this user is not found'\n            });\n            return;\n        }\n        // 密码校对( 数据库中的用户密码 === MD5(注册时生成的密码盐 + MD5(用户在前端表单输入的密码)) )\n        if (data.password === MD5(data.password_salt + formData.password)) {\n            // 密码校验成功，调用 loginResponse，设置 access_token 并返回用户信息\n            loginResponse(res, data);\n        } else {\n            // 返回密码错误\n            res.status(200).json({\n                code: 'fail',\n                msg: 'invalid password'\n            })\n        }\n    }).catch(err => errRes.dbQueryErr(res));\n});\n\n// 注册表单响应接口 [预处理管道: 手机号码验证、账号查重、密码加密验证]\nrouter.post('/register', [phoneValidator, repeatabilityValidator, md5Validator, vCodeValidator], (req, res) => {\n    // 删掉请求体中的验证码的属性\n    delete req.body.vCode;\n    // 创建用户对象\n    const time = new Date().getTime();\n    const userData = req.body;\n    // 生成 16位 密码盐\n    userData.password_salt = getRandomCode(16);\n    // 密码盐 + 密码 => MD5加密\n    userData.password = MD5(userData.password_salt + userData.password);\n    userData.avatar = '/avatar/default.jpg'; // 默认头像\n    userData.register_time = time; // 注册时间戳\n    userData.last_time = -1; // 最后登录时间戳\n    userData.permission = 0; // 权限等级\n\n    const user = new User(userData);\n    // 写入数据库\n    user.save().then(data => {\n        // 调用 loginResponse，设置 access_token 并返回用户信息\n        loginResponse(res, data);\n    }).catch(err => errRes.dbWriteErr(res));\n});\n\n/**\n * 登录响应 (登录/注册接口公用，登录/注册成功后回调该函数)\n * 生成 access_token(通行口令) 写入 cookie\n * 返回登录成功的 json 包含用户基本信息\n * @param {Object} res 响应体对象\n * @param {Object} data 数据库用户数据\n */\nfunction loginResponse(res, data) {\n    // 生成 32位 access_token\n    const access_token = getRandomCode(32);\n    // 更新数据库中的 access_token (之前登录的设备下一次 token 鉴权将失败，需要重新登录)\n    User.update(data, {\n        $set: {\n            access_token\n        }\n    }).then(_ => {\n        const expires = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000);\n        // 设置 cookie (30天有效期) [app 端会跨域，无法使用 cookie]\n        res.cookie('phone', data.phone, {\n            expires\n        });\n        res.cookie('access_token', access_token, {\n            expires\n        });\n        // 返回登录成功\n        res.status(200).json({\n            code: 'ok',\n            msg: 'auth passed',\n            userInfo: {\n                phone: data.phone,\n                access_token,\n                username: data.username,\n                avatar: data.avatar\n            }\n        });\n    }).catch(err => errRes.dbWriteErr(res));\n}\n\n// 短信验证码下发请求响应 [预处理管道: 手机格式验证]\nrouter.post('/sms', [phoneValidator], (req, res) => {\n    // 判断是否来自注册表单? 是则进行账号查重\n    req.body.r && repeatabilityValidator(req, res);\n    console.log(123);\n    const phone = req.body.phone;\n    // 生成6位验证码\n    let vCode = '';\n    // 随机数取整 -> 字符串 -> 字符串长度补全 方案 (ES6 API, Babel 无法转换 padStart)\n    // vCode = (~~(Math.random() * 1000000)).toString().padStart(6,'0');\n    // 拼接 方案 (兼容)\n    for (let i = 0; i < 6; i++) {\n        vCode += (~~(Math.random() * 10)).toString();\n    }\n    // 服务器端转发请求短信验证服务器下发短信验证码\n    request\n        .post('https://sms.yunpian.com/v2/sms/single_send.json')\n        // 请求头设置\n        // .set('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8')\n        .type('form')\n        .send({\n            apikey: config.SMS_APIKEY, // 短信验证服务器 developer apikey\n            mobile: phone, // 目标手机号码\n            text: `【${config.APP_NAME}】您的验证码是${vCode}。如非本人操作，请忽略本短信` // 短信模板\n        }).end((err, data) => {\n            if (data && data.body && data.body.code === 0) {\n                // 临时存储，写入数据库\n                // 查找有没有该用户的验证码记录？\n                // 存在就更新这条记录，不存在则插入一条\n                SMS.findOne({\n                    phone\n                }).then(data => {\n                    if (data) {\n                        // 更新数据\n                        SMS.update(data, {\n                            $set: {\n                                vCode\n                            }\n                        }).then(data => {\n                            // 返回发送成功，并设置超时删除\n                            sendSuccessResponse(res, {\n                                phone,\n                                vCode\n                            }, 10 * 60 * 1000);\n                        }).catch(err => errRes.dbWriteErr(res));\n                    } else {\n                        // 插入一条\n                        const sms = new SMS({\n                            phone,\n                            vCode\n                        });\n                        sms.save().then(data => {\n                            // 返回发送成功，并设置超时删除\n                            sendSuccessResponse(res, {\n                                phone,\n                                vCode\n                            }, 10 * 60 * 1000);\n                        }).catch(err => errRes.dbWriteErr(res));\n                    }\n                }).catch(err => errRes.dbQueryErr(res));\n            } else {\n                // 发送失败\n                res.status(200).json({\n                    code: 'err_sms',\n                    msg: 'sent failed'\n                });\n            }\n        });\n});\n/**\n * 返回短信下发成功，并设置超时删除的定时器任务\n * @param {Object} queryObj 查询对象 \n * @param {Number} time 时长 \n */\nfunction sendSuccessResponse(res, queryObj, time) {\n    // 返回前端，短信下发成功\n    res.status(200).json({\n        code: 'ok',\n        msg: 'sent succeeded'\n    });\n    // 超时后，如果这条数据(根据vCode查找)还存在*就删除它\n    // 若用户在超时范围内再次请求了验证码(更新了记录)，删除它的任务则应该交给下一个响应的定时器\n    setTimeout(_ => {\n        SMS.findObj(queryObj).then(data => {\n            // 存在就删掉它\n            data && SMS.remove(data);\n        });\n    }, time);\n}\n\n/**\n * 数据检测流 \n * (下面的验证函数应在响应前按需添加到'请求处理管线')\n * 用于后端数据二次验证，防止用户绕过前端表单验证发送请求，导致脏数据进入数据库\n * 各环节未通过返回的参数说明\n * 手机号码格式验证未通过  {code: err_phone}\n * 手机号码重复注册       {code: err_repeat}\n * md5 验证未通过        {code: err_md5}\n */\n// 手机号码格式验证\nfunction phoneValidator(req, res, next) {\n    const phoneRegexp = /^0?(13|14|15|18)[0-9]{9}$/;\n    const phone = req.body.phone;\n    // 通过验证？回调下一个检测流函数：返回未通过验证的响应\n    phoneRegexp.test(phone) ? next() : res.status(200).json({\n        code: 'phone',\n        msg: 'invalid phone number format'\n    });\n}\n// 号码查重 (用于注册表单响应)\nfunction repeatabilityValidator(req, res, next) {\n    const phone = req.body.phone;\n    // 数据库查询\n    User.findOne({\n        phone\n    }).then(data => {\n        // 是否没有数据? 回调下一个检测流函数: 返回号码重复\n        !data ? (next ? next() : '') : res.status(200).json({\n            code: 'repeat',\n            msg: 'repeat phone number'\n        })\n    }).catch(err => {\n        errRes.dbQueryErr(res);\n    });\n}\n// 密码 md5 验证 (验证前端发送过来的密码是否使用了 32位 md5加密)\nfunction md5Validator(req, res, next) {\n    // 判断请求的表单数据密码是否 为32位 hash\n    const md5Regexp = /^[0-9a-z]{32}$/;\n    const password = req.body.password;\n    md5Regexp.test(password) ? next() : res.status(200).json({\n        code: 'md5',\n        msg: 'invalid password md5'\n    });\n}\n// 短信验证码 验证\nfunction vCodeValidator(req, res, next) {\n    // 查找该验证码的记录\n    SMS.findOne({\n        phone: req.body.phone,\n        vCode: req.body.vCode\n    }).then(data => {\n        if (data) {\n            next(); // 回调下一个检测流函数\n        } else {\n            res.status(200).json({\n                code: 'vCode',\n                msg: 'invalid vCode'\n            });\n        }\n    }).catch(err => errRes.dbQueryErr(res));\n}\n\n\n// 工具 函数\n/**\n * 生成随机码\n * @param {Number} length 随机码长度\n * @returns 随机码字符串\n * getRandomCode(16) -> XGpU%FpjzV*7uSzP\n */\nfunction getRandomCode(length) {\n    let code = '';\n    const chars = \"~!@#$%^&*()_+,.?<>0123456789abcdefghijkmnpqrstuvwxyzABCDEFGHJKMNPQRSTUVWXYZ\";\n    for (let i = 0; i < length; i++) {\n        code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return code;\n}\n\n// 导出模块\nexport default router;"]}